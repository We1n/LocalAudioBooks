# План рефакторинга: Внедрение нижней навигации (Bottom Navigation)

## 1. Резюме и Цели

**Цель**: Преобразование навигационной архитектуры приложения из линейной (переходы «экран-в-экран» с кнопками «Назад») в таб-навигацию (Bottom Navigation Bar).

### Ключевые цели:

- [x] Внедрение панели навигации: Создать фиксированное нижнее меню с 3 разделами: «Плеер», «Каталог» (Библиотека), «Настройки» (включая аналитику)
- [x] Изменение макета (Layout): Обеспечить постоянное отображение навигации на всех главных экранах
- [x] Очистка UI: Удалить избыточные кнопки навигации (например, «Назад в библиотеку», «Перейти в настройки») внутри экранов
- [x] Создать новые экраны: HomeScreen (Главное с разделами "Слушаю" и "Мои книги"), SearchScreen (Поиск) - НЕ ИСПОЛЬЗУЮТСЯ в навигации, оставлены для возможного будущего использования

---

## 2. Анализ текущей ситуации

### Текущая архитектура:

- [x] Архитектура UI: В данный момент App.tsx рендерит экраны (LibraryScreen, PlayerScreen и т.д.) условно, основываясь на currentScreen из AppContext
- [x] Навигация: Осуществляется через вызов setCurrentScreen по клику на кнопки внутри экранов
- [x] Проблема: Пользователю приходится делать лишние клики для переключения между плеером и библиотекой. Отсутствует глобальная навигация

---

## 3. Предлагаемое решение / Стратегия рефакторинга

### 3.1. Высокоуровневый дизайн (High-Level Design)

```
App --> AppLayout
AppLayout --> ContentArea
AppLayout --> BottomNavigation
ContentArea --> LibraryScreen
ContentArea --> PlayerScreen
ContentArea --> SettingsScreen
SettingsScreen -.-> Statistics(Merged/Linked)
```

### 3.2. Ключевые компоненты

- [x] **BottomNavigation** (Новый компонент): Отвечает за рендеринг кнопок переключения экранов
- [x] **AppLayout** (Новый компонент/Модификация App): Обертка, задающая padding-bottom для контента
- [x] **Модификация экранов**: Удаление кнопок «Назад» и «Настройки» из шапок экранов

---

## 4. Детальный план действий

### Фаза 1: Компонент навигации

#### Задача 1.1: Создать компонент BottomNavigation
- [x] Создать файл `src/ui/components/BottomNavigation.tsx`
- [x] Реализовать фиксированную панель внизу экрана (`fixed bottom-0 w-full`)
- [x] Добавить элементы (3 таба):
  - [x] Плеер (Player) — иконка play/pause или треугольника
  - [x] Каталог (Library) — иконка книги/списка
  - [x] Настройки (Settings) — иконка шестеренки (включает аналитику)
- [x] Реализовать логику: При клике вызывает `setCurrentScreen`
- [x] Реализовать подсветку активного таба (accent color, например оранжевый)
- [x] Применить стилизацию: Темный фон (или системный), высокий z-index

**Критерии готовности**:
- [x] Компонент отображается внизу экрана
- [x] Все три кнопки кликабельны и переключают экраны
- [x] Активный таб визуально выделен

---

### Фаза 2: Интеграция Layout

#### Задача 2.1: Рефакторинг App.tsx
- [x] Внедрить компонент `BottomNavigation` внутрь `AppContent`
- [x] Обернуть рендеринг экранов (LibraryScreen, PlayerScreen и т.д.) в контейнер с `padding-bottom` (например, `pb-20`)
- [x] Убедиться, что контент не скрывается за навигацией

**Критерии готовности**:
- [x] Навигация отображается на всех экранах
- [x] Контент прокручивается до конца, не скрываясь за панелью
- [x] Переключение между экранами работает корректно

---

### Фаза 3: Адаптация экранов (Cleanup)

#### Задача 3.0: Создать новые экраны
- [x] Создать `HomeScreen.tsx` — экран с разделами "Слушаю" (горизонтальный список) и "Мои книги" (сетка)
- [x] Создать `SearchScreen.tsx` — экран поиска по книгам

#### Задача 3.1: Обновить LibraryScreen.tsx
- [x] Удалить кнопку «⚙️ Настройки» из верхнего хедера

#### Задача 3.2: Обновить PlayerScreen.tsx
- [x] Удалить кнопку «← Назад в библиотеку»
- [x] Удалить кнопку «⚙️ Настройки»

#### Задача 3.3: Обновить SettingsScreen.tsx
- [x] Удалить кнопку «← Назад»
- [x] Опционально: Убедиться, что доступ к аналитике (StatisticsScreen) очевиден и удобен

#### Задача 3.4: Обновить StatisticsScreen.tsx
- [x] Удалить кнопку «← Назад»

**Критерии готовности**:
- [x] Отсутствуют дублирующие навигационные кнопки в верхней части экранов
- [x] Все экраны доступны через нижнюю навигацию
- [x] Функциональность экранов не нарушена

---

### Фаза 4: Визуальная полировка

#### Задача 4.1: Стилизация под макет
- [x] Обеспечить, чтобы меню выглядело нативно (стеклянный эффект или сплошной цвет, тени)
- [x] Проверка отступов на мобильных устройствах (Safe Area для iOS)
- [x] Убедиться, что высота тач-зоны не менее 44px для удобства использования

**Критерии готовности**:
- [x] Меню выглядит профессионально и нативно
- [x] Корректное отображение на мобильных устройствах
- [x] Удобные размеры кнопок для пальцевого управления

---

## 5. Изменения в модели данных

- [x] Изменений в схеме данных (src/storage) не требуется
- [x] Используем существующий Screen тип в AppContext

---

## 6. Ключевые соображения и риски

### 6.1. Технические риски

#### Риск: Перекрытие контента
- [x] **Проблема**: Нижняя навигация может перекрыть кнопку действия (FAB) или конец списка книг
- [x] **Решение**: Использовать `pb-[height_of_nav]` в контейнере AppLayout (реализовано: pb-16 в App.tsx и pb-20 в экранах)

#### Риск: Состояние экрана статистики
- [x] **Проблема**: В текущей навигации statistics — это отдельный экран. В нижней навигации всего 3 кнопки
- [x] **Решение**: Экран statistics будет открываться либо поверх настроек (как модальное окно), либо быть частью экрана settings (реализовано: статистика доступна через кнопку в SettingsScreen)

### 6.2. Нефункциональные требования (NFRs)

- [x] **Usability**: Навигация должна быть доступна для пальца (высота тач-зоны не менее 44px) (реализовано: min-h-[44px] и touch-manipulation)
- [x] **Responsive**: Меню должно корректно отображаться и на десктопе (возможно, центрировано или растянуто, но в рамках мобильного стиля PWA) (реализовано: flex justify-around для равномерного распределения)

---

## 7. Метрики успеха

- [x] В нижней части приложения всегда отображается панель с 3 разделами
- [x] Переключение между Плеером и Каталогом происходит в один клик
- [x] Контент списков прокручивается до конца, не скрываясь за панелью
- [x] Отсутствуют дублирующие навигационные кнопки в верхней части экранов

---

## 8. Допущения

- [x] Мы используем существующие иконки (эмодзи) или простые SVG (реализовано: используются эмодзи иконки)
- [x] Аналитика остается частью экрана настроек (или подраздела), отдельная 4-я кнопка для неё не создается, чтобы не перегружать интерфейс (реализовано: статистика доступна через кнопку в SettingsScreen)

---

**Дата создания плана**: 2026-01-02  
**Версия**: 1.0  
**Статус**: ✅ Выполнено на 100%

